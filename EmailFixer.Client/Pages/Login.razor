@page "/login"
@inject IAuthService AuthService
@inject NavigationManager NavigationManager

<PageTitle>Login - Email Fixer</PageTitle>

<div class="login-container">
    <div class="login-card">
        <div class="text-center mb-4">
            <i class="fas fa-envelope-open-text fa-4x text-primary mb-3"></i>
            <h1 class="h3 mb-3 fw-bold">Welcome to Email Fixer</h1>
            <p class="text-muted">Professional Email Validation Service</p>
        </div>

        @if (_isLoading)
        {
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Redirecting to Google...</p>
            </div>
        }
        else
        {
            <div class="d-grid gap-3">
                <button class="btn btn-lg btn-google" @onclick="HandleGoogleLogin">
                    <i class="fab fa-google me-2"></i>
                    Sign in with Google
                </button>
            </div>

            @if (!string.IsNullOrEmpty(_errorMessage))
            {
                <div class="alert alert-danger mt-3" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    @_errorMessage
                </div>
            }

            <div class="text-center mt-4">
                <small class="text-muted">
                    By signing in, you agree to our Terms of Service and Privacy Policy
                </small>
            </div>
        }
    </div>
</div>

<style>
    .login-container {
        min-height: 80vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .login-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 3rem;
        max-width: 450px;
        width: 100%;
    }

    .btn-google {
        background-color: #4285f4;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-google:hover {
        background-color: #357ae8;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(66, 133, 244, 0.3);
    }

    .btn-google:active {
        transform: translateY(0);
    }
</style>

@code {
    private bool _isLoading = false;
    private string? _errorMessage;

    protected override async Task OnInitializedAsync()
    {
        // Check if user is already authenticated
        var isAuthenticated = await AuthService.IsAuthenticatedAsync();
        if (isAuthenticated)
        {
            NavigationManager.NavigateTo("/");
        }
    }

    private async Task HandleGoogleLogin()
    {
        try
        {
            _isLoading = true;
            _errorMessage = null;
            StateHasChanged();

            await AuthService.InitiateGoogleLoginAsync();
        }
        catch (Exception)
        {
            _isLoading = false;
            _errorMessage = "Failed to initiate Google login. Please try again.";
            StateHasChanged();
        }
    }
}
